<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- 他のヘッダー情報はここに記述 -->

  <style>
    /* 画像を操作するためのスタイル */
    #draggable-image {
      width: 100%;
      max-width: 100%;
      height: auto;
      user-drag: none;
      user-select: none;
      touch-action: none;
    }
  </style>
</head>
<body>
  <!-- 他のコンテンツとHTML要素はここに記述 -->

  <!-- 画像要素 -->
  <img id="draggable-image" src="" alt="画像">

  <script>
    // 画像要素の取得
    const image = document.getElementById('draggable-image');

    // ピンチジェスチャー変数の初期化
    let pinchStartDistance = 0;
    let pinchStartScale = 1;

    // タッチ操作が開始されたときの処理
    image.addEventListener('touchstart', (e) => {
      if (e.touches.length === 2) {
        // 2本の指でタッチされた場合（ピンチジェスチャー）
        const touch1 = e.touches[0];
        const touch2 = e.touches[1];

        // 2本の指の距離を計算
        pinchStartDistance = Math.hypot(touch2.clientX - touch1.clientX, touch2.clientY - touch1.clientY);
        pinchStartScale = parseFloat(image.style.transform.replace('scale(', '').replace(')', '')) || 1;
      }
    });

    // タッチ操作が移動中のときの処理
    image.addEventListener('touchmove', (e) => {
      if (e.touches.length === 2) {
        // 2本の指で移動中の場合（ピンチジェスチャー）
        const touch1 = e.touches[0];
        const touch2 = e.touches[1];

        // 2本の指の距離を再計算
        const pinchDistance = Math.hypot(touch2.clientX - touch1.clientX, touch2.clientY - touch1.clientY);

        // 画像の拡大縮小処理
        const newScale = pinchStartScale * (pinchDistance / pinchStartDistance);
        image.style.transform = `scale(${newScale})`;
      }
    });

    // タッチ操作が終了したときの処理
    image.addEventListener('touchend', () => {
      // ピンチジェスチャーの初期化
      pinchStartDistance = 0;
      pinchStartScale = 1;
    });

    // 画像のドラッグ処理
    let offsetX = 0;
    let offsetY = 0;
    let isDragging = false;

    // ドラッグ開始
    image.addEventListener('touchstart', (e) => {
      if (e.touches.length === 1) {
        const touch = e.touches[0];
        offsetX = touch.clientX - image.getBoundingClientRect().left;
        offsetY = touch.clientY - image.getBoundingClientRect().top;
        isDragging = true;
      }
    });

    // ドラッグ中
    image.addEventListener('touchmove', (e) => {
      if (isDragging && e.touches.length === 1) {
        const touch = e.touches[0];
        const newX = touch.clientX - offsetX;
        const newY = touch.clientY - offsetY;
        image.style.left = `${newX}px`;
        image.style.top = `${newY}px`;
      }
    });

    // ドラッグ終了
    image.addEventListener('touchend', () => {
      isDragging = false;
    });
  </script>
</body>
</html>
